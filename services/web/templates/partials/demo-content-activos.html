                <div id="table-root"></div>
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const { DataTable, FormPanel, HistoryPanel, Toast, api, confirmAction, PropertyPresentation } = AdminApp;
                Toast.init();
                const historyPanel = new HistoryPanel();
                const detailPanel = new DetailPanel();

                const formFields = [
                    { key: 'property_name', label: 'Property name', required: true, placeholder: 'e.g. 14 King Street, Flat 3B' },
                    { key: 'address', label: 'Address', required: true, placeholder: 'Full address' },
                    { key: 'contract_ref', label: 'Contract ref', placeholder: 'Contract reference' },
                    { key: 'status', label: 'Status', type: 'select', options: ['Vacant', 'Occupied', 'Rented', 'Under Renovation'], default: 'Vacant' },
                    { key: 'rent', label: 'Monthly rent', type: 'number', placeholder: '0.00' },
                    { key: 'start_date', label: 'Contract start', type: 'date' },
                    { key: 'end_date', label: 'Contract end', type: 'date' },
                    { key: 'tags', label: 'Tags (comma separated)', placeholder: 'tag1, tag2' },
                    { key: 'image_folder', label: 'Image folder', placeholder: 'e.g. king-street-14' },
                ];

                const formPanel = new FormPanel({
                    title: 'Property',
                    fields: formFields,
                    onSubmit: async (data, isEdit, original) => {
                        try {
                            if (isEdit) {
                                await api.put(`/properties/${original.id}`, data);
                                Toast.show('Property updated');
                            } else {
                                await api.post('/properties', data);
                                Toast.show('Property created');
                            }
                            table.load();
                        } catch (e) {
                            Toast.show(e.message, 'error');
                        }
                    }
                });

                const table = new DataTable('#table-root', {
                    entity: 'property',
                    apiPath: '/properties',
                    exportPath: '/export/properties',
                    columns: [
                        { key: 'thumbnail_url', label: 'Photo', type: 'thumbnail' },
                        { key: 'property_name', label: 'Name' },
                        { key: 'address', label: 'Address' },
                        { key: 'status', label: 'Status', type: 'status' },
                        { key: 'contract_ref', label: 'Contract' },
                        { key: 'rent', label: 'Rent', type: 'currency' },
                        { key: 'start_date', label: 'Start', type: 'date' },
                        { key: 'end_date', label: 'End', type: 'date' },
                        { key: 'tags', label: 'Tags', type: 'tags' },
                    ],
                    filters: [
                        { key: 'status', label: 'Status', options: ['Vacant', 'Occupied', 'Rented', 'Under Renovation'] }
                    ],
                    onRowClick: (row) => {
                        detailPanel.openActivo(row.id);
                    },
                    onAction: async (action, row) => {
                        if (action === 'create') formPanel.open();
                        if (action === 'edit') formPanel.open(row);
                        if (action === 'history') historyPanel.open('properties', row.id);
                        if (action === 'gallery') PropertyPresentation.open(row.id);
                        if (action === 'delete') {
                            const ok = await confirmAction('Delete property', `Delete "${row.property_name}"? This action cannot be undone.`);
                            if (ok) {
                                try {
                                    await api.del(`/properties/${row.id}`);
                                    Toast.show('Property deleted');
                                    table.load();
                                } catch (e) { Toast.show(e.message, 'error'); }
                            }
                        }
                    }
                });
            });
        </script>
